#!/usr/bin/perl

use warnings;
use strict;

use Wx;
use wxPerl::Constructors;

package MyApp;

use base 'Wx::App';

my $DebugOn = "true";

# --- No changes below here
my $VersionNumber = "1.0.0";
my $MyWxInfo = "";
my $myhome = $ENV{HOME};
my $GameDir = "$myhome/.aagames";

#my $RunCommand = "~/.local/share/Steam/steamapps/common/Argentum\ Age/anura.sh --module=citadel --server=argentumage.gameplayer.club:23456";
my $RunCommand = "~/.local/share/Steam/steamapps/common/Argentum\ Age/anura.sh --module=citadel";

# If storage folder doesn't exist, create it
if (! -d $GameDir)
{
	PrintDebug("Creating Directory '$GameDir'");
	mkdir $GameDir;
}

# Print debug info
sub PrintDebug
{
	if ($DebugOn eq "true")
	{
		print "$_[0]\n";
	}
}

# Sync the list of servers
sub SyncServerList
{
	PrintDebug("About to sync game server list");
}

# Display list of games
sub DisplayGameList
{
	PrintDebug("About to display game server list");
}

# Run game...
sub RunGame
{
	# Get the arguments
	my $CurServer = $_[0];
	my $CurPort = $_[1];

	my $SystemCommand = "$RunCommand --server=$CurServer:$CurPort";

	PrintDebug("Running '$SystemCommand'");
	system($SystemCommand);
}

# About Popup
sub AboutPopup
{
	PrintDebug("About to open the About popup");
	my $self = $MyWxInfo;

	my $frame = wxPerl::Frame->new(undef, 'About Argentum Age', size => [640, 480], position => [320, 320]);
	$frame->SetMinSize([320,160]);
	my $sizer = Wx::BoxSizer->new(&Wx::wxVERTICAL);

	my $aboutText = wxPerl::TextEntry->new($frame, 'About');
	$sizer->Add($aboutText);
	my $buttonAbout = wxPerl::Button->new($frame, 'About');
	$sizer->Add($buttonAbout, 2, &Wx::wxEXPAND);
	my $buttonDone = wxPerl::Button->new($frame, 'Done');
	$sizer->Add($buttonDone, 1, &Wx::wxEXPAND);
	Wx::Event::EVT_BUTTON($buttonAbout, -1, sub {
		my ($b, $evt) = @_;
		PrintDebug("Displaying About Field");
	});
	Wx::Event::EVT_BUTTON($buttonDone, -1, sub {
		$frame->Close;
	});

	$frame->SetSizer($sizer);
	$frame->Show;
}

# Main Init
sub OnInit
{
	my $self = shift;

	$MyWxInfo = $self;
	my $frame = wxPerl::Frame->new(undef, 'Argentum Age Games');
	$frame->SetMinSize([320,160]);
	my $sizer = Wx::BoxSizer->new(&Wx::wxVERTICAL);

	my $buttonGames = wxPerl::Button->new($frame, 'Games');
	$sizer->Add($buttonGames, 2, &Wx::wxEXPAND);
	my $buttonSync = wxPerl::Button->new($frame, 'Sync');
	$sizer->Add($buttonSync, 2, &Wx::wxEXPAND);
	my $buttonAbout = wxPerl::Button->new($frame, 'About');
	$sizer->Add($buttonAbout, 2, &Wx::wxEXPAND);
	my $buttonQuit = wxPerl::Button->new($frame, 'Quit');
	$sizer->Add($buttonQuit, 1, &Wx::wxEXPAND);
	Wx::Event::EVT_BUTTON($buttonGames, -1, sub {
		my ($b, $evt) = @_;
		$b->SetLabel('Clicked');
		$b->Disable;
		DisplayGameList();
		$b->Enable;
	});
	Wx::Event::EVT_BUTTON($buttonAbout, -1, sub {
		my ($b, $evt) = @_;
		$b->SetLabel('Clicked');
		$b->Disable;
		AboutPopup();
		$b->Enable;
	});
	Wx::Event::EVT_BUTTON($buttonSync, -1, sub {
		my ($b, $evt) = @_;
		$b->SetLabel('Clicked');
		$b->Disable;
		SyncServerList();
		$b->Enable;
	});
	Wx::Event::EVT_BUTTON($buttonQuit, -1, sub {
		&Wx::wxTheApp->ExitMainLoop;
	});

	$frame->SetSizer($sizer);
	$frame->Show;
}

MyApp->new->MainLoop;

exit 0;
